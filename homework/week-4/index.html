<!DOCTYPE html>

<html>
<head>
	<title>Weather Graph</title>
	<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
	<h1> Het weer in de Bilt</h1>
	<h2> Temperatuur in Celcius</h2>
	<h3> Tijd in maanden</h3>
	<div class = "weer">
		<canvas id="weathergraph"  width="1500" height="1000"></canvas>
	</div>
	<div class = "lijnen">
		<canvas id="lines" width="1500" height="1000"></canvas>
	</div>
	<div id ="weervalue">
	</div>
	<textarea id="weatherdata">
		2015/01/01,4.7
		2015/01/02,10.1
		2015/01/03,5.9
		2015/01/04,8.0
		2015/01/05,3.8
		2015/01/06,5.8
		2015/01/07,7.2
		2015/01/08,8.2
		2015/01/09,13.7
		2015/01/10,13.3
		2015/01/11,8.2
		2015/01/12,10.2
		2015/01/13,11.0
		2015/01/14,6.0
		2015/01/15,10.3
		2015/01/16,8.3
		2015/01/17,5.9
		2015/01/18,3.3
		2015/01/19,1.6
		2015/01/20,3.7
		2015/01/21,1.5
		2015/01/22,0.4
		2015/01/23,-1.3
		2015/01/24,6.8
		2015/01/25,5.6
		2015/01/26,8.3
		2015/01/27,7.7
		2015/01/28,7.2
		2015/01/29,4.5
		2015/01/30,4.4
		2015/01/31,4.4
		2015/02/01,5.7
		2015/02/02,5.5
		2015/02/03,6.3
		2015/02/04,5.3
		2015/02/05,2.0
		2015/02/06,3.1
		2015/02/07,5.5
		2015/02/08,6.7
		2015/02/09,7.2
		2015/02/10,7.2
		2015/02/11,5.4
		2015/02/12,4.5
		2015/02/13,9.9
		2015/02/14,10.2
		2015/02/15,6.7
		2015/02/16,7.7
		2015/02/17,9.0
		2015/02/18,8.1
		2015/02/19,7.4
		2015/02/20,6.5
		2015/02/21,6.3
		2015/02/22,6.8
		2015/02/23,9.8
		2015/02/24,8.9
		2015/02/25,8.7
		2015/02/26,8.3
		2015/02/27,8.2
		2015/02/28,9.1
		2015/03/01,10.7
		2015/03/02,8.4
		2015/03/03,7.5
		2015/03/04,7.6
		2015/03/05,10.3
		2015/03/06,9.0
		2015/03/07,13.9
		2015/03/08,15.7
		2015/03/09,11.3
		2015/03/10,11.3
		2015/03/11,9.5
		2015/03/12,12.7
		2015/03/13,9.2
		2015/03/14,5.3
		2015/03/15,6.8
		2015/03/16,12.8
		2015/03/17,17.8
		2015/03/18,8.8
		2015/03/19,12.6
		2015/03/20,9.3
		2015/03/21,9.3
		2015/03/22,8.6
		2015/03/23,9.3
		2015/03/24,11.5
		2015/03/25,6.9
		2015/03/26,7.3
		2015/03/27,8.9
		2015/03/28,11.7
		2015/03/29,11.3
		2015/03/30,9.1
		2015/03/31,11.1
		2015/04/01,9.1
		2015/04/02,8.6
		2015/04/03,9.5
		2015/04/04,9.4
		2015/04/05,11.3
		2015/04/06,11.7
		2015/04/07,13.2
		2015/04/08,14.2
		2015/04/09,18.1
		2015/04/10,19.6
		2015/04/11,13.6
		2015/04/12,15.5
		2015/04/13,12.8
		2015/04/14,20.0
		2015/04/15,23.0
		2015/04/16,13.4
		2015/04/17,12.9
		2015/04/18,14.4
		2015/04/19,15.2
		2015/04/20,17.1
		2015/04/21,17.4
		2015/04/22,12.1
		2015/04/23,15.5
		2015/04/24,20.4
		2015/04/25,15.0
		2015/04/26,13.9
		2015/04/27,12.6
		2015/04/28,11.8
		2015/04/29,14.7
		2015/04/30,14.2
		2015/05/01,13.3
		2015/05/02,15.8
		2015/05/03,17.0
		2015/05/04,19.4
		2015/05/05,22.2
		2015/05/06,15.5
		2015/05/07,16.2
		2015/05/08,19.4
		2015/05/09,16.1
		2015/05/10,19.1
		2015/05/11,25.6
		2015/05/12,17.5
		2015/05/13,18.1
		2015/05/14,16.7
		2015/05/15,14.4
		2015/05/16,14.9
		2015/05/17,16.2
		2015/05/18,14.0
		2015/05/19,13.7
		2015/05/20,14.7
		2015/05/21,17.4
		2015/05/22,19.9
		2015/05/23,15.7
		2015/05/24,19.9
		2015/05/25,15.3
		2015/05/26,15.8
		2015/05/27,18.9
		2015/05/28,16.5
		2015/05/29,15.8
		2015/05/30,15.4
		2015/05/31,16.5
		2015/06/01,16.1
		2015/06/02,17.7
		2015/06/03,17.7
		2015/06/04,22.0
		2015/06/05,31.8
		2015/06/06,18.9
		2015/06/07,18.9
		2015/06/08,17.2
		2015/06/09,15.0
		2015/06/10,20.8
		2015/06/11,24.0
		2015/06/12,27.4
		2015/06/13,21.3
		2015/06/14,19.5
		2015/06/15,17.5
		2015/06/16,17.7
		2015/06/17,22.7
		2015/06/18,16.6
		2015/06/19,15.3
		2015/06/20,16.3
		2015/06/21,18.5
		2015/06/22,15.3
		2015/06/23,15.1
		2015/06/24,21.5
		2015/06/25,24.0
		2015/06/26,25.0
		2015/06/27,21.8
		2015/06/28,23.2
		2015/06/29,24.2
		2015/06/30,27.3
		2015/07/01,33.1
		2015/07/02,33.1
		2015/07/03,29.1
		2015/07/04,32.7
		2015/07/05,28.2
		2015/07/06,23.8
		2015/07/07,25.8
		2015/07/08,19.6
		2015/07/09,17.6
		2015/07/10,22.6
		2015/07/11,28.7
		2015/07/12,20.4
		2015/07/13,19.6
		2015/07/14,21.3
		2015/07/15,21.1
		2015/07/16,25.1
		2015/07/17,25.6
		2015/07/18,22.1
		2015/07/19,20.5
		2015/07/20,21.4
		2015/07/21,25.4
		2015/07/22,23.1
		2015/07/23,21.7
		2015/07/24,23.3
		2015/07/25,18.3
		2015/07/26,20.9
		2015/07/27,19.7
		2015/07/28,18.9
		2015/07/29,17.6
		2015/07/30,18.1
		2015/07/31,19.4
		2015/08/01,22.0
		2015/08/02,24.2
		2015/08/03,30.0
		2015/08/04,21.5
		2015/08/05,25.0
		2015/08/06,28.4
		2015/08/07,27.0
		2015/08/08,23.0
		2015/08/09,24.3
		2015/08/10,25.2
		2015/08/11,25.4
		2015/08/12,23.0
		2015/08/13,28.4
		2015/08/14,25.4
		2015/08/15,22.1
		2015/08/16,16.6
		2015/08/17,15.2
		2015/08/18,16.8
		2015/08/19,22.5
		2015/08/20,24.9
		2015/08/21,25.3
		2015/08/22,26.5
		2015/08/23,25.9
		2015/08/24,23.1
		2015/08/25,19.9
		2015/08/26,25.2
		2015/08/27,18.5
		2015/08/28,20.9
		2015/08/29,23.6
		2015/08/30,25.3
		2015/08/31,26.5
		2015/09/01,19.5
		2015/09/02,18.8
		2015/09/03,17.1
		2015/09/04,16.6
		2015/09/05,16.9
		2015/09/06,17.0
		2015/09/07,16.9
		2015/09/08,16.9
		2015/09/09,18.5
		2015/09/10,19.6
		2015/09/11,20.1
		2015/09/12,20.2
		2015/09/13,19.4
		2015/09/14,19.8
		2015/09/15,15.9
		2015/09/16,19.2
		2015/09/17,16.4
		2015/09/18,18.4
		2015/09/19,17.5
		2015/09/20,18.1
		2015/09/21,18.6
		2015/09/22,17.4
		2015/09/23,17.3
		2015/09/24,15.7
		2015/09/25,16.8
		2015/09/26,16.8
		2015/09/27,17.5
		2015/09/28,16.0
		2015/09/29,17.4
		2015/09/30,17.5
		2015/10/01,16.9
		2015/10/02,18.3
		2015/10/03,18.8
		2015/10/04,17.9
		2015/10/05,16.9
		2015/10/06,17.6
		2015/10/07,17.6
		2015/10/08,15.9
		2015/10/09,16.3
		2015/10/10,14.3
		2015/10/11,11.5
		2015/10/12,10.2
		2015/10/13,5.9
		2015/10/14,8.0
		2015/10/15,8.0
		2015/10/16,8.4
		2015/10/17,9.0
		2015/10/18,10.9
		2015/10/19,12.5
		2015/10/20,12.6
		2015/10/21,12.5
		2015/10/22,14.8
		2015/10/23,14.1
		2015/10/24,13.8
		2015/10/25,14.3
		2015/10/26,15.8
		2015/10/27,17.3
		2015/10/28,13.3
		2015/10/29,15.6
		2015/10/30,15.0
		2015/10/31,14.3
		2015/11/01,16.0
	</textarea>
	<script>
	var canvas = document.getElementById('weathergraph');
	var lines = document.getElementById('lines');
	var linectx = lines.getContext("2d");
	var context = canvas.getContext("2d");
	var str = document.getElementById("weatherdata").innerText;
	// splitst op de nieuwe lijn
	var weerdata = str.split("\n");
	var dag = [];
	var temp = [];
	var padding = 25;
   	var step = 4;
   	var starty = 50;
   	var startx = 100;
   	var yas = 750;
   	var xas = 1300 + padding -5;


	function getMousePos(lines, pos) {
		var rect = lines.getBoundingClientRect();
		return {
			x: pos.clientX - rect.left,
			y: pos.clientY - rect.top
		};
	}

	lines.addEventListener('mousemove', function(pos) {
		var mousePos = getMousePos(lines, pos);
		linectx.clearRect(0,0,lines.width,lines.height);
		// y lijn
		if (mousePos.y < xas && mousePos.y > padding) {
			linectx.clearRect(0,0,lines.width,lines.height);
			linectx.beginPath();
			linectx.moveTo(mousePos.x,padding);
			linectx.lineTo(mousePos.x,yas);
			linectx.stroke();
		}
		// x lijn
		if (mousePos.x > startx && mousePos.x < xas){
			linectx.beginPath();
			var stretch = (xas - startx) / temp.length;
			var tempindex = Math.floor((mousePos.x - startx) / step);
			var dagindex = Math.floor((mousePos.x - startx) / step);
			var zcrossval = transformx(dag[dagindex]);
			var ycrossval = transformy(temp[tempindex]);

			
			var weervalue = document.getElementById('weervalue');
			weervalue.style.left = (mousePos.x + 9) +'px';
			weervalue.style.top = (mousePos.y) +'px';
			weervalue.style.display = "none";
			weervalue.innerHTML = ("<p>" + (temp[tempindex]) + "</br></br>" + (dag[dagindex]) + "</p>");
			setTimeout(function(){
				weervalue.style.display = "block";
			},500);
			//console.log(stretch);
			//console.log(tempindex);
			//console.log(ycrossval);

			linectx.moveTo(startx,ycrossval);
			linectx.lineTo(xas,ycrossval);
			linectx.stroke();

			
		} 
		//console.log(mousePos.x);
	}, false);

	// Transform functie
	function createTransform(domain, range){
		var alpha = (range[1] - range[0]) / (domain[1] -domain[0]);
		var beta = range[0] - alpha * domain[0];

		return function(x){
			return alpha * x + beta;
		};
	}

	var transformy = createTransform([-5, 30], [750, 100]);
	var transformx = createTransform([0, 365], [100, 1400]);
		//console.log(transformy(0));

		// Weerdata tekenen
		for (var i in weerdata) {
			var data = weerdata[i].split(",");
			dag.push(data[0]);
			temp.push(data[1]);
		}

		//console.log(dag)
	   	//console.log(temp);

	   	context.beginPath();
	   	for(x = 0; x < temp.length; x++){
	   		context.lineTo((step * x + startx), transformy(temp[x] + starty));
	   		context.moveTo((step * x + startx), transformy(temp[x] + starty));
	   		context.strokeStyle="LIME";
	   		context.stroke();
	   		// console.log(temp[x] + starty);
	   	}

	   	// Guide lines tekenen
	   	context.beginPath();
	   	context.moveTo(startx,padding);
	   	context.lineTo(startx,yas);
	   	context.lineTo(xas,yas);
	   	context.strokeStyle="black";
	   	context.stroke();
	   	context.stroke();

	   	var degrees = 750 / 8;
	   	context.beginPath();
	   	for(x = 0; x < 9; x++){
	   		var degreesnew = degrees * x;
	   		context.lineTo((x + startx), (degreesnew));
	   		context.moveTo((starty + padding), degreesnew + degrees);
	   		context.strokeStyle="black";
	   		context.stroke();
	   		// console.log(temp[x] + starty);
	   	}

	   	var month = 1400 / 12;
	   	context.beginPath();
	   	for(x = 0; x < 12; x++){
	   		var monthnew = month * x;
	   		context.lineTo((x + monthnew), (yas));
	   		context.moveTo((monthnew + month),(yas + padding));
	   		context.strokeStyle="black";
	   		context.stroke();
	   		// Lijnen kloppen niet helemaal
	   	}

	   	context.beginPath();
	   	context.setLineDash([5,2]);
	   	context.moveTo(startx,transformy(0));
	   	context.lineTo(xas,transformy(0));
	   	context.strokeStyle="gray";
	   	context.stroke();


	   	
	</script>
</body>
</html>